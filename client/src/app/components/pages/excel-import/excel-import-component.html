<div class="excel-import-container">
  <h2>üìÇ Importar movimientos bancarios</h2>

  <div class="upload-section">
    <input
      type="file"
      accept=".xlsx, .xls"
      (change)="onFileSelected($event)"
      #fileInput
      style="display: none;"
    />

    <button
      class="btn btn-primary"
      (click)="fileInput.click()"
      [disabled]="loading"
    >
      <span *ngIf="!loading">Seleccionar Excel</span>
      <span *ngIf="loading">Procesando...</span>
    </button>

    <span class="file-name-display" *ngIf="fileName">{{ fileName }}</span>
  </div>

  <div *ngIf="loading" class="loading">
    <p>Cargando y procesando archivo...</p>
  </div>

  <div *ngIf="!loading && pendingTransactions.length > 0" class="results-section">
    <h3>üìù Revisi√≥n de Transacciones ({{ pendingTransactions.length }})</h3>

    <div class="table-responsive">
      <table class="table">
        <thead class="table-header">
          <tr>
            <th>Importar</th>
            <th>Fecha</th>
            <th>Descripci√≥n</th>
            <th>Importe</th>
            <th>Tipo</th>
            <th>Categor√≠a</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let t of pendingTransactions" [class.row-income]="t.type === 'income'" [class.row-expense]="t.type === 'expense'">
            <td>
              <input type="checkbox" [(ngModel)]="t.selected">
            </td>
            <td>{{ t.date | date: 'dd/MM/yyyy' }}</td>
            <td>
              <input type="text" [(ngModel)]="t.description" class="form-control-sm" style="width: 100%">
            </td>
            <td [class.text-success]="t.type === 'income'" [class.text-danger]="t.type === 'expense'">
              {{ t.type === 'income' ? '+' : '' }}{{ t.amount | number:'1.2-2' }} ‚Ç¨
            </td>
            <td>
            <select
              class="form-select form-select-sm"
              [(ngModel)]="t.type"
              (change)="onTypeChange(t, $event)"
            >
              <option value="expense">Gasto</option>
              <option value="income">Ingreso</option>
              <option value="investment">Inversi√≥n</option>
            </select>
          </td>
            <td>
              <select
                class="form-select form-select-sm"
                [value]="t.category_id"
                (change)="onCategoryChange(t, $event)"
                [style.border-color]="t.category_id === 0 ? 'red' : ''"
              >
                <option [value]="0">-- Sin Categor√≠a --</option>
                <option value="NEW">Crear Nueva Categor√≠a...</option>
                <optgroup label="Categor√≠as Disponibles">
                  <option *ngFor="let cat of (t.type === 'income' ? incomeCategories : expenseCategories)" [value]="cat.id">
                    {{ cat.name }}
                  </option>
                </optgroup>
              </select>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="actions mt-3">
      <button class="btn btn-success save-button" (click)="saveAll()">
        üíæ Guardar Transacciones Seleccionadas
      </button>
    </div>
  </div>
</div>
